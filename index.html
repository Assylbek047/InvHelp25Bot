<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Мой Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <style>
    :root[data-theme="dark"]  { --bg:#111; --fg:#fff; --btn:#2a85ff; --muted:#aaa; }
    :root[data-theme="light"] { --bg:#fff; --fg:#111; --btn:#2a85ff; --muted:#666; }

    * { box-sizing: border-box; }
    html, body { height:100%; margin:0; }
    body {
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex; align-items: center; justify-content: center;
      padding: 24px;
    }
    .wrap { width: 100%; max-width: 640px; display:flex; flex-direction:column; gap:16px; align-items:center; text-align:center; }
    h1 { margin:0 0 4px; font-size:28px; }
    .muted { color: var(--muted); font-size:14px; }
    button {
      padding: 14px 20px;
      font-size: 16px;
      background: var(--btn);
      color: #fff;
      border: 0; border-radius: 12px;
      cursor: pointer;
    }
    .card {
      width:100%;
      background: rgba(127,127,127,0.08);
      border-radius: 12px;
      padding: 12px 14px;
      text-align: left;
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      white-space: pre-wrap;
    }
  </style>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <main class="wrap">
    <h1>Мой Mini App</h1>
    <p>Привет, <span id="user-name">гость</span>!</p>

    <!-- твоя кнопка остаётся и работает как раньше -->
    <button id="sendBtn">Отправить боту</button>

    <!-- небольшой лог ниже — поможет понять, внутри ли мы Telegram -->
    <div id="log" class="card" aria-live="polite"></div>
    <div class="muted">Если не видишь синюю системную кнопку внизу — открой Mini App через меню бота.</div>
  </main>

  <script>
    // утилита для лога
    const log = (m) => {
      const el = document.getElementById('log');
      el.textContent += (el.textContent ? "\n" : "") + m;
    };

    const tg = window.Telegram && window.Telegram.WebApp;

    if (tg) {
      // 1) готовим WebApp и подгоняем высоту
      tg.ready();
      try { tg.expand(); } catch(_) {}

      // 2) автотема под клиент Телеграма
      document.documentElement.dataset.theme = tg.colorScheme || 'dark';

      // 3) показываем имя пользователя, если есть
      const u = tg.initDataUnsafe && tg.initDataUnsafe.user;
      document.getElementById('user-name').textContent = u ? (u.first_name || 'пользователь') : 'гость';

      // 4) системная MainButton внизу (визуал как у «взрослых» mini app)
      tg.MainButton.setText('Отправить боту');
      tg.MainButton.show();

      // 5) твоя кнопка: при клике шлём данные боту
      const send = () => {
        try { tg.HapticFeedback.impactOccurred('light'); } catch(_) {}
        // оставляем твой текущий payload; позже сможем заменить на JSON
        tg.sendData('Hello from Mini App!');
        log('sendData отправлено: Hello from Mini App!');
      };

      document.getElementById('sendBtn').addEventListener('click', send);
      tg.MainButton.onClick(send);

      log('WebApp: OK. Платформа: ' + (tg.platform || 'unknown'));
    } else {
      // страница открыта НЕ в Telegram (обычный браузер)
      document.getElementById('user-name').textContent = 'гость';
      log('⚠️ WebApp объект недоступен — это не Telegram. Открой страницу из меню бота.');
    }
  </script>
</body>
</html>
